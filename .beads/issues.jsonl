{"id":"bd-0we","content_hash":"f11e7b6bd112ec6093f475b9cf32e4fdfbe002e5fda9eb0b2d5d9ef4e2b62e84","title":"Bug: E2E test doesn't catch Fatal errors from brew-offline-install","description":"","design":"## Bug Description\nE2E test script doesn't catch \"Fatal:\" errors from brew-offline-install,\nonly looks for \"Error:\" prefix.\n\n## Reproduction Steps\n1. Run E2E test that triggers a Fatal error\n2. Test checks: if vm_exec \"$install_cmd\" | grep -q \"Error:\"; then\n3. Fatal error is missed, test reports success\n\n## Expected Behavior\nTest should catch both \"Error:\" and \"Fatal:\" messages.\n\n## Actual Behavior\nOnly catches \"Error:\", misses \"Fatal:\" failures.\n\n## Root Cause\nFile: test/integration/phases/verify-install.sh:67\n\n```bash\nif vm_exec \"$install_cmd\" 2\u003e\u00261 | grep -q \"Error:\"; then\n  error \"  Failed to install $name\"\n```\n\nHomebrew uses different error prefixes:\n- \"Error:\" for recoverable errors\n- \"Fatal:\" for unrecoverable errors\n\n## Solution Approach\nChange grep pattern to catch both:\n```bash\nif vm_exec \"$install_cmd\" 2\u003e\u00261 | grep -qE \"(Error:|Fatal:)\"; then\n```\n\nOr use exit code instead of string matching.","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2025-11-14T10:28:52.798447-05:00","updated_at":"2025-11-14T10:29:18.067559-05:00","source_repo":"."}
{"id":"bd-snn","content_hash":"c80fcfd579698505d850d7a7f814ace2391d531c50eae99fff18171d248cdc28","title":"Bug: brew-offline-install fails on Homebrew 5.0+ bundled taps","description":"","design":"## Bug Description\nbrew-offline-install fails immediately on Homebrew 5.0+ with:\n\"Fatal: homebrew-core tap not found at /opt/homebrew/Library/Taps/homebrew/homebrew-core\"\n\nThis prevents ANY package installation from offline mirrors.\n\n## Reproduction Steps\n1. Create mirror: brew offline mirror -d ~/mirror -f jq\n2. Try to install: brew offline install jq\n3. See: \"Fatal: homebrew-core tap not found at /opt/homebrew/Library/Taps/homebrew/homebrew-core\"\n\n## Expected Behavior\nShould install jq from the mirror without errors.\n\n## Actual Behavior\nFails before even attempting installation.\n\n## Root Cause\nFile: mirror/bin/brew-offline-install:87-90\n\nCode checks for tap directory:\n```ruby\nunless Dir.exist?(CORE_TAP_DIR)\n  abort \"Fatal: homebrew-core tap not found at #{CORE_TAP_DIR}\"\nend\n```\n\nIn Homebrew 5.0+:\n- Core and cask taps are BUNDLED (no separate directory)\n- They exist at /opt/homebrew/Library/Taps/homebrew/homebrew-{core,cask}\n- But these are just symlinks/references, not full git repos\n- The actual tap data is bundled in Homebrew itself\n\nThis check was valid for Homebrew 4.x where taps were separate git clones.\n\n## Solution Approach\nRemove the tap directory check for bundled taps. Instead:\n1. Check if Homebrew is installed (already done on line 83)\n2. Trust that bundled taps are available\n3. Only check third-party tap directories\n\nOr use TapManager.tap_installed? which handles bundled taps correctly.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-11-14T10:28:45.208024-05:00","updated_at":"2025-11-14T10:29:07.011164-05:00","source_repo":"."}
